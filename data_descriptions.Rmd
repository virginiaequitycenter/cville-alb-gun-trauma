---
title: "Data Descriptions"
author: Samantha Toet
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(ggmap)
library(janitor)
library(lubridate)
library(magrittr)
library(reactable)
library(reactablefmtr)
library(tidyverse)

```

The data listed below represent information that is publicly and readily available online. This document is meant to serve as an overview of the existing resources so that we can begin representing the nature, shape, and dimensions of the problem locally.

All of this data is administrative and made up of information created when people interact with public services. As a result, we need to remember the deeply human aspect of this data. Granted personal info is scrubbed from this report, we should keep in mind that these are people and members of our community that we are talking about.

The script [dataprep.R](https://github.com/virginiaequitycenter/cville-alb-gun-trauma/blob/main/data_prep.R) outlines the process for accessing and cleaning each data source.

------------------------------------------------------------------------

# Gun Violence Archive {.tabset}

The national [Gun Violence Archive](https://www.gunviolencearchive.org/) describes gun violence as:

> "all incidents of death or injury or threat with firearms... a shooting of a victim by a subject/suspect is considered gun violence as is a defensive use or an officer involved shooting. The act itself, no matter the reason is violent in nature."

This database includes information collected from public news sources about 201 incidents of gun violence affecting 306 participants in the Charlottesville/Albemarle region from May 2014 - April 2024. The incidents range from shots fired reports, to unlawful gun ownership, to acts of violence such as assault, suicide, and homicide.

The data is made up of two dataframes: one has information about each incident and the associated outcome variables (for example, the number of people injured and/or killed), and the other lists the participant-level information (for example, the age rage and gender of the participants for both victims and suspects). The data includes the location and date of each incident along with characteristics such as injury, homicide, or shots fired. The data does not give any identifiable information about the participants, including name, race, ethnicity, socioeconomic status, or mental health status.

<details>

<summary>Exclusions</summary>

Because the data is sourced from public news websites, if an act of violence didn't receive local news attention it was not included in the Gun Violence Archive database. That means this data underrepresents some information, especially shots fired numbers. Notably, it looks like shots fired incidents haven't been added to the database since 2021.

</details>

<br>

## Incident-level data

```{r gva_incidents}

gva_incidents <- read_csv("data/gva_incidents.csv") 

gva_incidents %>%
  group_by(yr = year(incident_date)) %>%
  summarise(total_injured = sum(victims_injured + suspects_injured),
            total_killed = sum(victims_killed + suspects_killed)) %>%
  ungroup() %>%
  pivot_longer(matches("total")) %>% 
  ggplot(aes(x = yr, y = value, fill = name)) +
  geom_col() +
  labs(title = "Victims of Gun Violence in the Charlottesville/Albemarle Region",
       x = "Year",
       y = "Number of Victims",
       caption = "Total incidents: 201") +
  theme(axis.text.x = element_text(angle=35)) +
  scale_fill_manual(labels = c("Injured", "Killed"),
                    values = c("#F8BE3D", "#007BAB"),
                    guide = guide_legend(title = "Victim Status"))
```

## Individual-level data

```{r gva_participants}

gva_participants <- read_csv("data/gva_participants.csv") 

gva_participants %>%
  drop_na(age) %>%
  mutate(yr = year(incident_date)) %>%
  ggplot(aes(age, fill = role)) +
  geom_histogram(position = 'identity') +
  facet_grid(~role) +
scale_fill_manual(labels = c("Suspect", "Victim"),
                    values = c("#F8BE3D", "#007BAB"),
                    guide = guide_legend(title = "Participant Role")) +
  labs(title = "Ages of Participants",
       x = "Age",
       y = "Number of People", 
       caption = "Total particpants: 306") +
  theme(axis.text.x = element_text(angle=35))
```

------------------------------------------------------------------------

# Charlottesville Open Data Portal {.tabset}

The [Charlottesville Open Data Portal](https://opendata.charlottesville.org/datasets/charlottesville::crime-data/about) includes 526 gun-related crime reports, and 390 gun-related arrests in City of Charlottesville from March 2019 through April 2024. The data is managed by the Charlottesville Police Department and updated nightly.

The dataset is made up of two dataframes: one includes information about initial crime reports and the other includes arrest data. Both datasets have been anonymized to remove names and other identifiable information.

This is not a definitive collection of public safety data for Charlottesville. We should consider the factors that influence the inclination of an individual calling the police. Are there systematic reasons that someone might call the police more or less than someone else? It's also significant to note that just because a call was made, does not mean that an arrest was made. All individuals are innocent until proven guilty in a court of law.

<details>

<summary>Exclusions</summary>

These datasets only contain information reported by City of Charlottesville Police. It does not contain information about incidents that solely involve other police departments operating within the city (for example, University of Virginia police or Albemarle County police).

</details>

```{r odp_crimemap, fig.show="hold", fig.width=4, out.width= "50%"}

odp_crimes <- read_csv("data/odp_crimes.csv") 
odp_arrests <- read_csv("data/odp_arrests.csv")

cville_map <- get_map(c(left = -78.53, bottom = 38.00, right = -78.45, top = 38.07), 
                      maptype = "roadmap", color = "bw")

# Geographic spread
ggmap(cville_map) +
  stat_density2d(data = odp_crimes, aes(fill = ..level.., alpha = 0.1), # removes 55 values
                 geom = "polygon") +
  theme(legend.position="none") +
  scale_fill_viridis_c(direction = -1) +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank()) +
  labs(title = "Gun-Related Crime Reports",
       caption = "Total reports: 526")

ggmap(cville_map) +
  stat_density2d(data = odp_arrests, aes(fill = ..level.., alpha = 0.1), # removes 96 values
                 geom = "polygon") +
  theme(legend.position="none") +
  scale_fill_viridis_c(direction = -1) +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank()) +
  labs(title = "Gun-Related Arrests",
       caption = "Total arrests: 390")

```

## Crime Reports

As defined by the Charlottesville Police Department, a crime report

> "represents the initial information that is provided by individuals calling for police assistance."

The crime dataset includes 526 calls for police assistance and includes the time of a call, the type of incident, the geocoded location of the incident, and the reporting officer. The data is maintained by CPD and updated nightly.

The data has been filtered to only include crime reports that involve firearms. To do this, only offences labeled *Shots Fired/Illegal Hunting*, *Robbery - Armed*, and *Weapons Violations* are used. As a result, this data may significantly underrepresent the number of firearm incidents. For example, crime reports that have *Assault* as the primary offense are not included because we cannot be certain the assault included firearm. 

------------------------------------------------------------------------

## Arrest Reports

From the Charlottesville Open Data Portal:

> "Arrest data contains information on people taken into custody by City of Charlottesville police officers. More serious crimes such as felony offenses are more likely to result in an arrest. However, arrests can occur as a result of other offenses, such as parole violations or a failure to appear for trial."

The below data contains the distribution of 390 arrests for firearm-related charges. The data has been anonymized so that identifiable information has been removed. Here we can see that of the 233 individuals arrested, 147 have only one gun-related charge, 53 have two charges, and one person has 15 charges. In other words, half of all people arrested for gun-related crimes have between 2-4 charges.

```{r odp_arrests}

# Distribution of arrests by person
odp_arrests %>%
  group_by(id) %>%
  summarise(charges = n()) %>%
  ungroup() %>%
  ggplot(aes(y = charges)) +
  geom_bar(fill = "#007BAB") +
  geom_text(aes(label =..count..), stat = "count", hjust = -0.25, size = 3) +
  labs(title = "Distribution of Gun-Related Arrests",
       x = "Number of People",
       y = "Number of Charges",
       caption = "Total number of people arrested: 233") +
  scale_y_continuous(breaks = c(1:15))
```

------------------------------------------------------------------------

## Violent Offenses

Arrests charges are considered violent if the statute description includes phrases such as *shooting*, *assault*, *discharge*, *pointing*, or *reckless*. Nonviolent offenses mostly consist of possession and distribution charges.

If we organize the gun-related arrests into violent vs. nonviolent offenses, we can see that both types of arrests are equally distributed, with the number of non-violent arrests slightly increasing between 2021 - 2023. In general, for every violent arrest, there is at least one other nonviolent arrest. Is this because charges often get stacked against individuals?

```{r odp_violence}

# Distribution of violent arrests 
odp_arrests %>%
group_by(yr = year(arrest_datetime), grp) %>%
  summarise(n = n()) %>%
  ggplot(aes(x = yr, y = n, fill = grp)) +
  geom_col() +
  labs(title = "Distribution of Violent Gun-Related Arrests",
       x = "Year",
       y = "Number of Arrests",
       caption = "Note: the dataset begins in May 2019 and ends in April 2024, so only half of those years are represented.") +
  scale_fill_manual(labels = c("Violent", "Nonviolent"),
                    values = c("#F8BE3D", "#007BAB"),
                    guide = guide_legend(title = "Offense Type")) +
  theme(axis.text.x = element_text(angle=35))

```

------------------------------------------------------------------------

# Virginia Open Data Portal {.tabset}

The [Virginia Open Data Portal](https://data.virginia.gov/) includes information about emergency department visits for firearm injuries along with death certificates for firearm-related causes of death.

This data is supplied by the Virginia Department of Health and updated monthly.

<details>
<summary>Exclusions</summary>
Exclusions include follow-up visits, visits involving other types of guns (e.g., staple gun), visits where firearm was used as a weapon but not fired (e.g., pistol whip). City/county localities are assigned using the patient's residential zip code for Virginia residents. Patients with non-Virginia or unknown zip codes are grouped as 'Out of State.' 
</details>
<br>

## Injuries in Cville/Albemarle

The Virginia Department of Health groups Charlottesville City and Albemarle county together for their firearm injury counts from 2015 - 2023. This aggregation doesn't include any demographic information.

Firearm injury visits are identified using key terms in the chief complaint (reason for visit) and discharge diagnosis codes. Key terms include: gun with wound, GSW, gunshot, buckshot, revolver, rifle, shotgun, firearm, pistol, handgun, been shot, I was shot, I got shot, combination of hit, ricochet, graze with bullet. ICD-10 diagnosis codes: W32.0, W32.1, W33.0, W33.1, W34.0, W34.1, X72, X73, X74, X93, X94, X95, Y22, Y23, Y24, Y35.0, Y38.4 SNOMED diagnosis codes: 41430008, 56768003, 63409001, 69861004, 77301004, 86122002, 111050005, 219257002, 283545005, 218081007, 218086002, 218082000, 218087006, 218088001, 269796009, 242869008, 219199009, 219200007, 219201006, 219204003, 219205002, 219203009, 219198001, 219142001, 219143006, 219144000, 219145004, 219146003, 287184008, 287193009.

```{r vdh_county}

fai_county <- read_csv("data/fai_county.csv") 

fai_county %>%
  filter(str_detect(patient_city_county, "Albemarle")) %>%
  arrange(year) %>%
  select(-patient_city_county) %>%
  reactable(
    defaultColDef = colDef(
      header = function(value) str_to_title(gsub("_", " ", value, fixed = TRUE)),
      align = "center",
      defaultSortOrder = "desc",
      headerStyle = list(background = "#f7f7f8")),
    columns = list(
      total_ed_visits = colDef(format = colFormat(separators = TRUE))),
    bordered = TRUE,
    highlight = TRUE) 

```

## Deaths in Blue Ridge Health District

The Blue Ridge Health District includes Charlottesville City, Albemarle, Greene, Louisa, Fluvanna, and Nelson County. This is the smallest age aggregation from the VDH.

This dataset includes the number and rate of firearm-related deaths among Virginia residents by patient health district and Age over 5 combined years. Virginia Department of Health (VDH) health districts are assigned based on the residence of the patient at the time of death, not where the death occurred. Data include Virginia residents only, whether or not they died in Virginia. Data set includes deaths from 2018 through 2022.

The VDH Office of Vital Records tracks causes of death among Virginia residents using death certificates. Codes on the death certificate indicate underlying and contributing causes of death. Deaths are classified as firearm-related using the definition from the Centers for Disease Control and Prevention State Injury Indicators Report

```{r vdh_ages}

fai_age <- read_csv("data/fai_age.csv")

fai_age %>%
  select(-health_district) %>%
  arrange(age_group) %>%
  reactable(
    defaultColDef = colDef(
      header = function(value) str_to_title(gsub("_", " ", value, fixed = TRUE)),
      align = "center",
      defaultSortOrder = "desc",
      headerStyle = list(background = "#f7f7f8")),
    columns = list(
      total_ed_visits = colDef(format = colFormat(separators = TRUE))),
    bordered = TRUE,
    highlight = TRUE,
    defaultPageSize = 11) %>%
  add_source(source = "Years: 2018-2022",
             align = "right",
             font_size = 12)

```

------------------------------------------------------------------------

# FBI Data Explorer

Crime data for Virginia are pulled from the [Uniform Crime Reporting](https://va.beyond2020.com/va_public/Browse/browsetables.aspx) database.


### Definitions 

The **Number of Crimes** measure is calculated using the FBI Unit of Count. It equals the number of offenses committed during an incident, except in the following cases:

- If Offense Type is Crimes against Person, then the count is set to Number of Victims. 

- If Offense Type is Motor Vehicle Theft, then the count is set to Attempted Motor Vehicle Thefts plus the Number of Stolen Motor Vehicles.

Each offense belongs to one of three categories: **Crimes Against Persons, Crimes Against Property, and Crimes Against Society**. This is measured under the `type` variable. Crimes Against Persons, e.g., murder, rape, and assault, are those whose victims are always individuals. The object of Crimes Against Property, e.g., robbery, bribery, and burglary, is to obtain money, property, or some other benefit. Crimes Against Society, e.g., gambling, prostitution, and drug violations, represent societyâ€™s prohibition against engaging in certain types of activity; they are typically victimless crimes in which property is not the object. See a detailed breakdown here: [FBI Definitions of Crimes Aginst Person, Property, and Society](https://ucr.fbi.gov/nibrs/2012/resources/crimes-against-persons-property-and-society) 

The **Number of Incidents** measure counts the number of incidents with a specific offense type submitted to the system that match the selections in other dimensions. This value is typically lower than the number of offenses, as multiple offenses may be committed within a single incident.

### Data Dictionary 

The data contains summaries of all crimes where a firearm was used in Virginia, Albemarle County, and Charlottesville City between 2016 - 2022. Each row represents a different type of crime for each year and each column represents crime counts and rates. 

`year`: The annual aggregation of the data. Vales range from 2016 - 2022.

`type`: The type of offense being observed. Can be crime against person, property, or society.  

`n_juvenile`: The number of crimes or incidents committed by a person under 18. 

`n_adult`: The number of crimes or incidents committed by a person above 18. 

`n_unknown`: The number of crimes or incidents where the age was unknown. 

`n_missing`: The number of crimes or incidents where the age was missing. 

`n_total`: The total number of crimes or incidents for a given district in a given year. 

`district`: The geographic location where the crimes and incidents took place. Values can be Charlottesville, Albemarle, and Virginia. 

`est_pop_district`: The estimated population of the district for that year. Calculated from most recent census. This is the denominator for the rate calculations. 
